========================================
PTW Unit Test Starting
========================================

=== Test 1: Reset Functionality ===
PTW reset completed
PASS: PTW ready after reset

=== Test 2: Two-Level Page Table Walk ===
Testing [         4K page - VPN1=0,VPN0=0]: vaddr=0x00000000
  [TASK] Starting translation for vaddr=0x00000000
  [TASK] PTW ready, sending request
[PTW] Request: vaddr=0x00000000, vpn1=   0, vpn0=   0
[PTW] State change: 0 -> 1
  [DEBUG] PTW request: vaddr=0x00000000, VPN1=   0, VPN0=   0
  [TASK] Request sent, waiting for response
[PTW] Memory Request: addr=0x00000400
[PTW] State change: 1 -> 2
  [DEBUG] Memory request: addr=0x00000400
[PTW] Memory Response: data=0x00000801
[PTW] State change: 2 -> 3
  [DEBUG] Memory response: data=0x00000801
[PTW] Memory Request: addr=0x00000801
[PTW] State change: 3 -> 4
  [DEBUG] Memory request: addr=0x00000801
[PTW] Memory Response: data=0x1000000f
[PTW] State change: 4 -> 5
  [DEBUG] Memory response: data=0x1000000f
  [TASK] Response received
  [DEBUG] PTW response: pte=0x1000000f
[PTW] Response: pte=0x1000000f
[PTW] State change: 5 -> 0
  [TASK] Translation completed: 0x00000000 -> 0x1000000f
PASS [         4K page - VPN1=0,VPN0=0]: vaddr=0x00000000 -> pte=0x1000000f

Testing [         4K page - VPN1=0,VPN0=1]: vaddr=0x00001000
  [TASK] Starting translation for vaddr=0x00001000
  [TASK] PTW ready, sending request
[PTW] Request: vaddr=0x00001000, vpn1=   0, vpn0=   1
[PTW] State change: 0 -> 1
  [DEBUG] PTW request: vaddr=0x00001000, VPN1=   0, VPN0=   1
  [TASK] Request sent, waiting for response
[PTW] Memory Request: addr=0x00000400
[PTW] State change: 1 -> 2
  [DEBUG] Memory request: addr=0x00000400
[PTW] Memory Response: data=0x00000801
[PTW] State change: 2 -> 3
  [DEBUG] Memory response: data=0x00000801
[PTW] Memory Request: addr=0x00000805
[PTW] State change: 3 -> 4
  [DEBUG] Memory request: addr=0x00000805
[PTW] Memory Response: data=0x1100000f
[PTW] State change: 4 -> 5
  [DEBUG] Memory response: data=0x1100000f
  [TASK] Response received
  [DEBUG] PTW response: pte=0x1100000f
[PTW] Response: pte=0x1100000f
[PTW] State change: 5 -> 0
  [TASK] Translation completed: 0x00001000 -> 0x1100000f
PASS [         4K page - VPN1=0,VPN0=1]: vaddr=0x00001000 -> pte=0x1100000f

Testing [         4K page - VPN1=0,VPN0=2]: vaddr=0x00002000
  [TASK] Starting translation for vaddr=0x00002000
  [TASK] PTW ready, sending request
[PTW] Request: vaddr=0x00002000, vpn1=   0, vpn0=   2
[PTW] State change: 0 -> 1
  [DEBUG] PTW request: vaddr=0x00002000, VPN1=   0, VPN0=   2
  [TASK] Request sent, waiting for response
[PTW] Memory Request: addr=0x00000400
[PTW] State change: 1 -> 2
  [DEBUG] Memory request: addr=0x00000400
[PTW] Memory Response: data=0x00000801
[PTW] State change: 2 -> 3
  [DEBUG] Memory response: data=0x00000801
[PTW] Memory Request: addr=0x00000809
[PTW] State change: 3 -> 4
  [DEBUG] Memory request: addr=0x00000809
[PTW] Memory Response: data=0x12000007
[PTW] State change: 4 -> 5
  [DEBUG] Memory response: data=0x12000007
  [TASK] Response received
  [DEBUG] PTW response: pte=0x12000007
[PTW] Response: pte=0x12000007
[PTW] State change: 5 -> 0
  [TASK] Translation completed: 0x00002000 -> 0x12000007
PASS [         4K page - VPN1=0,VPN0=2]: vaddr=0x00002000 -> pte=0x12000007


=== Test 3: Megapage Translation ===
Testing [        Megapage - VPN1=1,VPN0=0]: vaddr=0x40000000
  [TASK] Starting translation for vaddr=0x40000000
  [TASK] PTW ready, sending request
[PTW] Request: vaddr=0x40000000, vpn1= 256, vpn0=   0
[PTW] State change: 0 -> 1
  [DEBUG] PTW request: vaddr=0x40000000, VPN1= 256, VPN0=   0
  [TASK] Request sent, waiting for response
[PTW] Memory Request: addr=0x00000800
[PTW] State change: 1 -> 2
  [DEBUG] Memory request: addr=0x00000800
[PTW] Memory Response: data=0x1000000f
[PTW] State change: 2 -> 3
  [DEBUG] Memory response: data=0x1000000f
[PTW] Memory Request: addr=0x1000000f
[PTW] State change: 3 -> 4
  [DEBUG] Memory request: addr=0x1000000f
[PTW] Memory Response: data=0x00000000
[PTW] State change: 4 -> 5
  [DEBUG] Memory response: data=0x00000000
  [TASK] Response received
  [DEBUG] PTW response: pte=0x00000000
[PTW] Response: pte=0x00000000
[PTW] State change: 5 -> 0
  [TASK] Translation completed: 0x40000000 -> 0x00000000
ERROR [        Megapage - VPN1=1,VPN0=0]: Translation mismatch
  VAddr:    0x40000000
  Expected: 0x12340007
  Got:      0x00000000

Testing [        Megapage - VPN1=1,VPN0=1]: vaddr=0x40001000
  [TASK] Starting translation for vaddr=0x40001000
  [TASK] PTW ready, sending request
[PTW] Request: vaddr=0x40001000, vpn1= 256, vpn0=   1
[PTW] State change: 0 -> 1
  [DEBUG] PTW request: vaddr=0x40001000, VPN1= 256, VPN0=   1
  [TASK] Request sent, waiting for response
[PTW] Memory Request: addr=0x00000800
[PTW] State change: 1 -> 2
  [DEBUG] Memory request: addr=0x00000800
[PTW] Memory Response: data=0x1000000f
[PTW] State change: 2 -> 3
  [DEBUG] Memory response: data=0x1000000f
[PTW] Memory Request: addr=0x10000013
[PTW] State change: 3 -> 4
  [DEBUG] Memory request: addr=0x10000013
[PTW] Memory Response: data=0x00000000
[PTW] State change: 4 -> 5
  [DEBUG] Memory response: data=0x00000000
  [TASK] Response received
  [DEBUG] PTW response: pte=0x00000000
[PTW] Response: pte=0x00000000
[PTW] State change: 5 -> 0
  [TASK] Translation completed: 0x40001000 -> 0x00000000
ERROR [        Megapage - VPN1=1,VPN0=1]: Translation mismatch
  VAddr:    0x40001000
  Expected: 0x12341007
  Got:      0x00000000


=== Test 4: Invalid Page Table Entries ===
Testing [                Invalid L1 entry]: vaddr=0x80000000
  [TASK] Starting translation for vaddr=0x80000000
  [TASK] PTW ready, sending request
[PTW] Request: vaddr=0x80000000, vpn1= 512, vpn0=   0
[PTW] State change: 0 -> 1
  [DEBUG] PTW request: vaddr=0x80000000, VPN1= 512, VPN0=   0
  [TASK] Request sent, waiting for response
[PTW] Memory Request: addr=0x00000c00
[PTW] State change: 1 -> 2
  [DEBUG] Memory request: addr=0x00000c00
[PTW] Memory Response: data=0x00000000
[PTW] State change: 2 -> 5
  [DEBUG] Memory response: data=0x00000000
  [TASK] Response received
  [DEBUG] PTW response: pte=0x00000000
[PTW] Response: pte=0x00000000
[PTW] State change: 5 -> 0
  [TASK] Translation completed: 0x80000000 -> 0x00000000
PASS [                Invalid L1 entry]: vaddr=0x80000000 -> pte=0x00000000

Testing [                Invalid L2 entry]: vaddr=0x00003000
  [TASK] Starting translation for vaddr=0x00003000
  [TASK] PTW ready, sending request
[PTW] Request: vaddr=0x00003000, vpn1=   0, vpn0=   3
[PTW] State change: 0 -> 1
  [DEBUG] PTW request: vaddr=0x00003000, VPN1=   0, VPN0=   3
  [TASK] Request sent, waiting for response
[PTW] Memory Request: addr=0x00000400
[PTW] State change: 1 -> 2
  [DEBUG] Memory request: addr=0x00000400
[PTW] Memory Response: data=0x00000801
[PTW] State change: 2 -> 3
  [DEBUG] Memory response: data=0x00000801
[PTW] Memory Request: addr=0x0000080d
[PTW] State change: 3 -> 4
  [DEBUG] Memory request: addr=0x0000080d
[PTW] Memory Response: data=0x00000000
[PTW] State change: 4 -> 5
  [DEBUG] Memory response: data=0x00000000
  [TASK] Response received
  [DEBUG] PTW response: pte=0x00000000
[PTW] Response: pte=0x00000000
[PTW] State change: 5 -> 0
  [TASK] Translation completed: 0x00003000 -> 0x00000000
PASS [                Invalid L2 entry]: vaddr=0x00003000 -> pte=0x00000000


========================================
PTW Test Summary:
  Tests Passed:           6
  Tests Failed:           2
  SOME TESTS FAILED!
========================================
