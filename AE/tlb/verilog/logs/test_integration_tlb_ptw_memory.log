Memory initialized with        1024 words
Page table structure (1024-word memory):
  Root PT at 0x0400 (word index 256)
  L2 PT at 0x0800 (word index 512)
  Usable address range: 0x0000-0x00000ffc
========================================
TLB + PTW + Memory Integration Test
========================================
Memory Layout (from memory.v initialization):
  Root PT at 0x0400 (word index 256):
    [0] = 0x00000801 -> L2 PT at 0x0800
    [1] = 0x12340007 -> Megapage PPN=0x1234, R+W
    [2] = 0x00000000 -> Invalid
  L2 PT at 0x0800 (word index 512):
    [0] = 0x1000000F -> PPN=0x10000, R+W+X
    [1] = 0x1100000F -> PPN=0x11000, R+W+X
    [2] = 0x12000007 -> PPN=0x12000, R+W
    [3] = 0x00000000 -> Invalid
========================================

=== Test 1: System Reset ===
VCD info: dumpfile test_integration_tlb_ptw_memory.vcd opened for output.
[RESET] System reset completed
PASS: System ready after reset

=== Test 2: First Translation (Page Walk) ===

--- Test:    First translation - page walk ---
  [TRANS] Starting translation: vaddr=0x00000000, type= READ
[PTW] Request: vaddr=0x00000000, vpn1=   0, vpn0=   0
  [PIPELINE] TLB->PTW request: vaddr=0x00000000
[PTW] Memory Request: addr=0x00000400
[MEM] Request: addr=0x00000400, word_idx= 256
  [PIPELINE] PTW->Memory request: addr=0x00000400
[PTW] Memory Response: data=0x00000801
[MEM] Response: data=0x00000801
  [PIPELINE] Memory->PTW response: data=0x00000801
[PTW] Memory Request: addr=0x00000800
[MEM] Request: addr=0x00000800, word_idx= 512
  [PIPELINE] PTW->Memory request: addr=0x00000800
[PTW] Memory Response: data=0x1000000f
[MEM] Response: data=0x1000000f
  [PIPELINE] Memory->PTW response: data=0x1000000f
  [PIPELINE] PTW->TLB response: pte=0x1000000f
[PTW] Response: pte=0x1000000f
  [TRANS] Complete: paddr=0x10000000, hit=0, fault=0
PASS [   First translation - page walk]

=== Test 3: TLB Hit ===

--- Test:              TLB hit - same page ---
  [TRANS] Starting translation: vaddr=0x00000123, type= READ
  [TRANS] Complete: paddr=0x10000123, hit=1, fault=0
PASS [             TLB hit - same page]

=== Test 4: Different Page (Same L2 Table) ===

--- Test:         Different page - same L2 ---
  [TRANS] Starting translation: vaddr=0x00001000, type= READ
  [PIPELINE] TLB->PTW request: vaddr=0x00001000
[PTW] Request: vaddr=0x00001000, vpn1=   0, vpn0=   1
  [PIPELINE] PTW->Memory request: addr=0x00000400
[MEM] Request: addr=0x00000400, word_idx= 256
[PTW] Memory Request: addr=0x00000400
  [PIPELINE] Memory->PTW response: data=0x00000801
[MEM] Response: data=0x00000801
[PTW] Memory Response: data=0x00000801
  [PIPELINE] PTW->Memory request: addr=0x00000804
[MEM] Request: addr=0x00000804, word_idx= 513
[PTW] Memory Request: addr=0x00000804
  [PIPELINE] Memory->PTW response: data=0x1100000f
[MEM] Response: data=0x1100000f
[PTW] Memory Response: data=0x1100000f
[PTW] Response: pte=0x1100000f
  [PIPELINE] PTW->TLB response: pte=0x1100000f
  [TRANS] Complete: paddr=0x11000000, hit=0, fault=0
PASS [        Different page - same L2]

--- Test:               Hit on second page ---
  [TRANS] Starting translation: vaddr=0x00001abc, type= READ
  [TRANS] Complete: paddr=0x11000abc, hit=1, fault=0
PASS [              Hit on second page]

=== Test 6: Third Page Translation ===

--- Test:           Third page translation ---
  [TRANS] Starting translation: vaddr=0x00002000, type= READ
[PTW] Request: vaddr=0x00002000, vpn1=   0, vpn0=   2
  [PIPELINE] TLB->PTW request: vaddr=0x00002000
[PTW] Memory Request: addr=0x00000400
[MEM] Request: addr=0x00000400, word_idx= 256
  [PIPELINE] PTW->Memory request: addr=0x00000400
[PTW] Memory Response: data=0x00000801
[MEM] Response: data=0x00000801
  [PIPELINE] Memory->PTW response: data=0x00000801
[PTW] Memory Request: addr=0x00000808
[MEM] Request: addr=0x00000808, word_idx= 514
  [PIPELINE] PTW->Memory request: addr=0x00000808
[PTW] Memory Response: data=0x12000007
[MEM] Response: data=0x12000007
  [PIPELINE] Memory->PTW response: data=0x12000007
  [PIPELINE] PTW->TLB response: pte=0x12000007
[PTW] Response: pte=0x12000007
  [TRANS] Complete: paddr=0x12000000, hit=0, fault=0
PASS [          Third page translation]

=== Test 7: Write Access Tests ===

--- Test:          Write to R+W page (hit) ---
  [TRANS] Starting translation: vaddr=0x00002456, type=WRITE
  [TRANS] Complete: paddr=0x12000456, hit=1, fault=0
PASS [         Write to R+W page (hit)]

--- Test:        Write to R+W+X page (hit) ---
  [TRANS] Starting translation: vaddr=0x00000789, type=WRITE
  [TRANS] Complete: paddr=0x10000789, hit=1, fault=0
PASS [       Write to R+W+X page (hit)]

=== Test 10: TLB Capacity Test ===
  [TRANS] Starting translation: vaddr=0x00000000, type= READ
  [TRANS] Complete: paddr=0x10000000, hit=1, fault=0
  Capacity test           0: vaddr=0x00000000 -> paddr=0x10000000, hit=1
  [TRANS] Starting translation: vaddr=0x00002000, type= READ
  [TRANS] Complete: paddr=0x12000000, hit=1, fault=0
  Capacity test           1: vaddr=0x00002000 -> paddr=0x12000000, hit=1
  [TRANS] Starting translation: vaddr=0x00004000, type= READ
  [PIPELINE] TLB->PTW request: vaddr=0x00004000
[PTW] Request: vaddr=0x00004000, vpn1=   0, vpn0=   4
  [PIPELINE] PTW->Memory request: addr=0x00000400
[MEM] Request: addr=0x00000400, word_idx= 256
[PTW] Memory Request: addr=0x00000400
  [PIPELINE] Memory->PTW response: data=0x00000801
[MEM] Response: data=0x00000801
[PTW] Memory Response: data=0x00000801
  [PIPELINE] PTW->Memory request: addr=0x00000810
[MEM] Request: addr=0x00000810, word_idx= 516
[PTW] Memory Request: addr=0x00000810
  [PIPELINE] Memory->PTW response: data=0x00000000
[MEM] Response: data=0x00000000
[PTW] Memory Response: data=0x00000000
[PTW] Response: pte=0x00000000
  [PIPELINE] PTW->TLB response: pte=0x00000000
  [TRANS] Complete: paddr=0x00000000, hit=0, fault=1
  Capacity test           2: vaddr=0x00004000 -> paddr=0x00000000, hit=0
  [TRANS] Starting translation: vaddr=0x00003000, type= READ
[PTW] Request: vaddr=0x00003000, vpn1=   0, vpn0=   3
  [PIPELINE] TLB->PTW request: vaddr=0x00003000
[PTW] Memory Request: addr=0x00000400
[MEM] Request: addr=0x00000400, word_idx= 256
  [PIPELINE] PTW->Memory request: addr=0x00000400
[PTW] Memory Response: data=0x00000801
[MEM] Response: data=0x00000801
  [PIPELINE] Memory->PTW response: data=0x00000801
[PTW] Memory Request: addr=0x0000080c
[MEM] Request: addr=0x0000080c, word_idx= 515
  [PIPELINE] PTW->Memory request: addr=0x0000080c
[PTW] Memory Response: data=0x00000000
[MEM] Response: data=0x00000000
  [PIPELINE] Memory->PTW response: data=0x00000000
  [PIPELINE] PTW->TLB response: pte=0x00000000
[PTW] Response: pte=0x00000000
  [TRANS] Complete: paddr=0x00000000, hit=0, fault=1
  Capacity test           3: vaddr=0x00003000 -> paddr=0x00000000, hit=0
  [TRANS] Starting translation: vaddr=0x00005000, type= READ
  [PIPELINE] TLB->PTW request: vaddr=0x00005000
[PTW] Request: vaddr=0x00005000, vpn1=   0, vpn0=   5
  [PIPELINE] PTW->Memory request: addr=0x00000400
[MEM] Request: addr=0x00000400, word_idx= 256
[PTW] Memory Request: addr=0x00000400
  [PIPELINE] Memory->PTW response: data=0x00000801
[MEM] Response: data=0x00000801
[PTW] Memory Response: data=0x00000801
  [PIPELINE] PTW->Memory request: addr=0x00000814
[MEM] Request: addr=0x00000814, word_idx= 517
[PTW] Memory Request: addr=0x00000814
  [PIPELINE] Memory->PTW response: data=0x00000000
[MEM] Response: data=0x00000000
[PTW] Memory Response: data=0x00000000
[PTW] Response: pte=0x00000000
  [PIPELINE] PTW->TLB response: pte=0x00000000
  [TRANS] Complete: paddr=0x00000000, hit=0, fault=1
  Capacity test           4: vaddr=0x00005000 -> paddr=0x00000000, hit=0
  [TRANS] Starting translation: vaddr=0x00007000, type= READ
[PTW] Request: vaddr=0x00007000, vpn1=   0, vpn0=   7
  [PIPELINE] TLB->PTW request: vaddr=0x00007000
[PTW] Memory Request: addr=0x00000400
[MEM] Request: addr=0x00000400, word_idx= 256
  [PIPELINE] PTW->Memory request: addr=0x00000400
[PTW] Memory Response: data=0x00000801
[MEM] Response: data=0x00000801
  [PIPELINE] Memory->PTW response: data=0x00000801
[PTW] Memory Request: addr=0x0000081c
[MEM] Request: addr=0x0000081c, word_idx= 519
  [PIPELINE] PTW->Memory request: addr=0x0000081c
[PTW] Memory Response: data=0x00000000
[MEM] Response: data=0x00000000
  [PIPELINE] Memory->PTW response: data=0x00000000
  [PIPELINE] PTW->TLB response: pte=0x00000000
[PTW] Response: pte=0x00000000
  [TRANS] Complete: paddr=0x00000000, hit=0, fault=1
  Capacity test           5: vaddr=0x00007000 -> paddr=0x00000000, hit=0
  [TRANS] Starting translation: vaddr=0x00006000, type= READ
  [PIPELINE] TLB->PTW request: vaddr=0x00006000
[PTW] Request: vaddr=0x00006000, vpn1=   0, vpn0=   6
  [PIPELINE] PTW->Memory request: addr=0x00000400
[MEM] Request: addr=0x00000400, word_idx= 256
[PTW] Memory Request: addr=0x00000400
  [PIPELINE] Memory->PTW response: data=0x00000801
[MEM] Response: data=0x00000801
[PTW] Memory Response: data=0x00000801
  [PIPELINE] PTW->Memory request: addr=0x00000818
[MEM] Request: addr=0x00000818, word_idx= 518
[PTW] Memory Request: addr=0x00000818
  [PIPELINE] Memory->PTW response: data=0x00000000
[MEM] Response: data=0x00000000
[PTW] Memory Response: data=0x00000000
[PTW] Response: pte=0x00000000
  [PIPELINE] PTW->TLB response: pte=0x00000000
  [TRANS] Complete: paddr=0x00000000, hit=0, fault=1
  Capacity test           6: vaddr=0x00006000 -> paddr=0x00000000, hit=0
  [TRANS] Starting translation: vaddr=0x00008000, type= READ
[PTW] Request: vaddr=0x00008000, vpn1=   0, vpn0=   8
  [PIPELINE] TLB->PTW request: vaddr=0x00008000
[PTW] Memory Request: addr=0x00000400
[MEM] Request: addr=0x00000400, word_idx= 256
  [PIPELINE] PTW->Memory request: addr=0x00000400
[PTW] Memory Response: data=0x00000801
[MEM] Response: data=0x00000801
  [PIPELINE] Memory->PTW response: data=0x00000801
[PTW] Memory Request: addr=0x00000820
[MEM] Request: addr=0x00000820, word_idx= 520
  [PIPELINE] PTW->Memory request: addr=0x00000820
[PTW] Memory Response: data=0x00000000
[MEM] Response: data=0x00000000
  [PIPELINE] Memory->PTW response: data=0x00000000
  [PIPELINE] PTW->TLB response: pte=0x00000000
[PTW] Response: pte=0x00000000
  [TRANS] Complete: paddr=0x00000000, hit=0, fault=1
  Capacity test           7: vaddr=0x00008000 -> paddr=0x00000000, hit=0

=== Test 11: Performance Test ===
  [TRANS] Starting translation: vaddr=0x00000000, type= READ
  [TRANS] Complete: paddr=0x10000000, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000100, type=WRITE
  [TRANS] Complete: paddr=0x10000100, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000200, type= READ
  [TRANS] Complete: paddr=0x10000200, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000300, type=WRITE
  [TRANS] Complete: paddr=0x10000300, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000400, type= READ
  [TRANS] Complete: paddr=0x10000400, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000500, type=WRITE
  [TRANS] Complete: paddr=0x10000500, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000600, type= READ
  [TRANS] Complete: paddr=0x10000600, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000700, type=WRITE
  [TRANS] Complete: paddr=0x10000700, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000800, type= READ
  [TRANS] Complete: paddr=0x10000800, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000900, type=WRITE
  [TRANS] Complete: paddr=0x10000900, hit=1, fault=0

=== Test 12: Mixed Read/Write Pattern ===
  [TRANS] Starting translation: vaddr=0x00000000, type= READ
  [TRANS] Complete: paddr=0x10000000, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00001004, type= READ
  [TRANS] Complete: paddr=0x11000004, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00002008, type=WRITE
  [TRANS] Complete: paddr=0x12000008, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x0000080c, type=WRITE
  [TRANS] Complete: paddr=0x1000080c, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000010, type= READ
  [TRANS] Complete: paddr=0x10000010, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00001014, type= READ
  [TRANS] Complete: paddr=0x11000014, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00002018, type=WRITE
  [TRANS] Complete: paddr=0x12000018, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x0000081c, type=WRITE
  [TRANS] Complete: paddr=0x1000081c, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00000020, type= READ
  [TRANS] Complete: paddr=0x10000020, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00001024, type= READ
  [TRANS] Complete: paddr=0x11000024, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x00002028, type=WRITE
  [TRANS] Complete: paddr=0x12000028, hit=1, fault=0
  [TRANS] Starting translation: vaddr=0x0000082c, type=WRITE
  [TRANS] Complete: paddr=0x1000082c, hit=1, fault=0

========================================
Integration Test Summary
========================================
Test Results:
  Tests Passed:          18
  Tests Failed:           0
  Success Rate: 100.0%

Performance Statistics:
  Total Requests:          37
  TLB Hits:          28 (75.7%)
  TLB Misses:           9 (24.3%)
  Page Faults:           6 (16.2%)
  Hit Rate: 75.7%
========================================
ALL TESTS PASSED!
The complete TLB+PTW+Memory pipeline works correctly!
========================================
