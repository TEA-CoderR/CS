========================================
PTW Unit Test Starting
========================================

=== Test 1: Reset Functionality ===
PTW reset completed
PASS: PTW ready after reset

=== Test 2: Two-Level Page Table Walk ===
Testing [         4K page - VPN1=0,VPN0=0]: vaddr=0x00000000
  [PTW] Starting translation for vaddr=0x00000000
[PTW] Request: vaddr=0x00000000, vpn1=   0, vpn0=   0
  [DEBUG] PTW request: vaddr=0x00000000, VPN1=   0, VPN0=   0
[35] PTW State: 0 -> 1
[PTW] Memory Request: addr=0x00000400
  [DEBUG] Memory request: addr=0x00000400
[55] PTW State: 1 -> 2
[PTW] Memory Response: data=0x00000801
  [DEBUG] Memory response: data=0x00000801
[75] PTW State: 2 -> 3
[PTW] Memory Request: addr=0x00000800
  [DEBUG] Memory request: addr=0x00000800
[95] PTW State: 3 -> 4
[PTW] Memory Response: data=0x1000000f
  [DEBUG] Memory response: data=0x1000000f
[115] PTW State: 4 -> 5
[PTW] Response: pte=0x1000000f
  [DEBUG] PTW response: pte=0x1000000f
[135] PTW State: 5 -> 0
  [PTW] Translation complete: pte=0x1000000f
PASS [         4K page - VPN1=0,VPN0=0]: vaddr=0x00000000 -> pte=0x1000000f

Testing [         4K page - VPN1=0,VPN0=1]: vaddr=0x00001000
  [PTW] Starting translation for vaddr=0x00001000
[165] PTW State: 0 -> 1
  [DEBUG] PTW request: vaddr=0x00001000, VPN1=   0, VPN0=   1
[PTW] Request: vaddr=0x00001000, vpn1=   0, vpn0=   1
[185] PTW State: 1 -> 2
  [DEBUG] Memory request: addr=0x00000400
[PTW] Memory Request: addr=0x00000400
[205] PTW State: 2 -> 3
  [DEBUG] Memory response: data=0x00000801
[PTW] Memory Response: data=0x00000801
[225] PTW State: 3 -> 4
  [DEBUG] Memory request: addr=0x00000804
[PTW] Memory Request: addr=0x00000804
[245] PTW State: 4 -> 5
  [DEBUG] Memory response: data=0x1100000f
[PTW] Memory Response: data=0x1100000f
[265] PTW State: 5 -> 0
  [DEBUG] PTW response: pte=0x1100000f
[PTW] Response: pte=0x1100000f
  [PTW] Translation complete: pte=0x1100000f
PASS [         4K page - VPN1=0,VPN0=1]: vaddr=0x00001000 -> pte=0x1100000f

Testing [         4K page - VPN1=0,VPN0=2]: vaddr=0x00002000
  [PTW] Starting translation for vaddr=0x00002000
[PTW] Request: vaddr=0x00002000, vpn1=   0, vpn0=   2
  [DEBUG] PTW request: vaddr=0x00002000, VPN1=   0, VPN0=   2
[295] PTW State: 0 -> 1
[PTW] Memory Request: addr=0x00000400
  [DEBUG] Memory request: addr=0x00000400
[315] PTW State: 1 -> 2
[PTW] Memory Response: data=0x00000801
  [DEBUG] Memory response: data=0x00000801
[335] PTW State: 2 -> 3
[PTW] Memory Request: addr=0x00000808
  [DEBUG] Memory request: addr=0x00000808
[355] PTW State: 3 -> 4
[PTW] Memory Response: data=0x12000007
  [DEBUG] Memory response: data=0x12000007
[375] PTW State: 4 -> 5
[PTW] Response: pte=0x12000007
  [DEBUG] PTW response: pte=0x12000007
[395] PTW State: 5 -> 0
  [PTW] Translation complete: pte=0x12000007
PASS [         4K page - VPN1=0,VPN0=2]: vaddr=0x00002000 -> pte=0x12000007


=== Test 4: Invalid Page Table Entries ===
Testing [                Invalid L1 entry]: vaddr=0x80000000
  [PTW] Starting translation for vaddr=0x80000000
[425] PTW State: 0 -> 1
  [DEBUG] PTW request: vaddr=0x80000000, VPN1= 512, VPN0=   0
[PTW] Request: vaddr=0x80000000, vpn1= 512, vpn0=   0
[445] PTW State: 1 -> 2
  [DEBUG] Memory request: addr=0x00000c00
[PTW] Memory Request: addr=0x00000c00
[465] PTW State: 2 -> 5
  [DEBUG] Memory response: data=0x00000000
[PTW] Memory Response: data=0x00000000
[485] PTW State: 5 -> 0
  [DEBUG] PTW response: pte=0x00000000
[PTW] Response: pte=0x00000000
  [PTW] Translation complete: pte=0x00000000
PASS [                Invalid L1 entry]: vaddr=0x80000000 -> pte=0x00000000

Testing [                Invalid L2 entry]: vaddr=0x00003000
  [PTW] Starting translation for vaddr=0x00003000
[PTW] Request: vaddr=0x00003000, vpn1=   0, vpn0=   3
  [DEBUG] PTW request: vaddr=0x00003000, VPN1=   0, VPN0=   3
[515] PTW State: 0 -> 1
[PTW] Memory Request: addr=0x00000400
  [DEBUG] Memory request: addr=0x00000400
[535] PTW State: 1 -> 2
[PTW] Memory Response: data=0x00000801
  [DEBUG] Memory response: data=0x00000801
[555] PTW State: 2 -> 3
[PTW] Memory Request: addr=0x0000080c
  [DEBUG] Memory request: addr=0x0000080c
[575] PTW State: 3 -> 4
[PTW] Memory Response: data=0x00000000
  [DEBUG] Memory response: data=0x00000000
[595] PTW State: 4 -> 5
[PTW] Response: pte=0x00000000
  [DEBUG] PTW response: pte=0x00000000
[615] PTW State: 5 -> 0
  [PTW] Translation complete: pte=0x00000000
PASS [                Invalid L2 entry]: vaddr=0x00003000 -> pte=0x00000000


=== Test 5: Address Decomposition Test ===
Testing VPN extraction:
Testing [                  VPN1=0, VPN0=0]: vaddr=0x00000000
  [PTW] Starting translation for vaddr=0x00000000
[645] PTW State: 0 -> 1
  [DEBUG] PTW request: vaddr=0x00000000, VPN1=   0, VPN0=   0
[PTW] Request: vaddr=0x00000000, vpn1=   0, vpn0=   0
[665] PTW State: 1 -> 2
  [DEBUG] Memory request: addr=0x00000400
[PTW] Memory Request: addr=0x00000400
[685] PTW State: 2 -> 3
  [DEBUG] Memory response: data=0x00000801
[PTW] Memory Response: data=0x00000801
[705] PTW State: 3 -> 4
  [DEBUG] Memory request: addr=0x00000800
[PTW] Memory Request: addr=0x00000800
[725] PTW State: 4 -> 5
  [DEBUG] Memory response: data=0x1000000f
[PTW] Memory Response: data=0x1000000f
[745] PTW State: 5 -> 0
  [DEBUG] PTW response: pte=0x1000000f
[PTW] Response: pte=0x1000000f
  [PTW] Translation complete: pte=0x1000000f
PASS [                  VPN1=0, VPN0=0]: vaddr=0x00000000 -> pte=0x1000000f

Testing [                  VPN1=0, VPN0=1]: vaddr=0x00001000
  [PTW] Starting translation for vaddr=0x00001000
[PTW] Request: vaddr=0x00001000, vpn1=   0, vpn0=   1
  [DEBUG] PTW request: vaddr=0x00001000, VPN1=   0, VPN0=   1
[775] PTW State: 0 -> 1
[PTW] Memory Request: addr=0x00000400
  [DEBUG] Memory request: addr=0x00000400
[795] PTW State: 1 -> 2
[PTW] Memory Response: data=0x00000801
  [DEBUG] Memory response: data=0x00000801
[815] PTW State: 2 -> 3
[PTW] Memory Request: addr=0x00000804
  [DEBUG] Memory request: addr=0x00000804
[835] PTW State: 3 -> 4
[PTW] Memory Response: data=0x1100000f
  [DEBUG] Memory response: data=0x1100000f
[855] PTW State: 4 -> 5
[PTW] Response: pte=0x1100000f
  [DEBUG] PTW response: pte=0x1100000f
[875] PTW State: 5 -> 0
  [PTW] Translation complete: pte=0x1100000f
PASS [                  VPN1=0, VPN0=1]: vaddr=0x00001000 -> pte=0x1100000f


=== Test 6: Edge Cases ===
Testing [             Last valid L2 entry]: vaddr=0x00002000
  [PTW] Starting translation for vaddr=0x00002000
[905] PTW State: 0 -> 1
  [DEBUG] PTW request: vaddr=0x00002000, VPN1=   0, VPN0=   2
[PTW] Request: vaddr=0x00002000, vpn1=   0, vpn0=   2
[925] PTW State: 1 -> 2
  [DEBUG] Memory request: addr=0x00000400
[PTW] Memory Request: addr=0x00000400
[945] PTW State: 2 -> 3
  [DEBUG] Memory response: data=0x00000801
[PTW] Memory Response: data=0x00000801
[965] PTW State: 3 -> 4
  [DEBUG] Memory request: addr=0x00000808
[PTW] Memory Request: addr=0x00000808
[985] PTW State: 4 -> 5
  [DEBUG] Memory response: data=0x12000007
[PTW] Memory Response: data=0x12000007
[1005] PTW State: 5 -> 0
  [DEBUG] PTW response: pte=0x12000007
[PTW] Response: pte=0x12000007
  [PTW] Translation complete: pte=0x12000007
PASS [             Last valid L2 entry]: vaddr=0x00002000 -> pte=0x12000007


=== Test 7: Back-to-Back Translations ===
Testing [                  Back-to-back 1]: vaddr=0x00000000
  [PTW] Starting translation for vaddr=0x00000000
[PTW] Request: vaddr=0x00000000, vpn1=   0, vpn0=   0
  [DEBUG] PTW request: vaddr=0x00000000, VPN1=   0, VPN0=   0
[1035] PTW State: 0 -> 1
[PTW] Memory Request: addr=0x00000400
  [DEBUG] Memory request: addr=0x00000400
[1055] PTW State: 1 -> 2
[PTW] Memory Response: data=0x00000801
  [DEBUG] Memory response: data=0x00000801
[1075] PTW State: 2 -> 3
[PTW] Memory Request: addr=0x00000800
  [DEBUG] Memory request: addr=0x00000800
[1095] PTW State: 3 -> 4
[PTW] Memory Response: data=0x1000000f
  [DEBUG] Memory response: data=0x1000000f
[1115] PTW State: 4 -> 5
[PTW] Response: pte=0x1000000f
  [DEBUG] PTW response: pte=0x1000000f
[1135] PTW State: 5 -> 0
  [PTW] Translation complete: pte=0x1000000f
PASS [                  Back-to-back 1]: vaddr=0x00000000 -> pte=0x1000000f

Testing [                  Back-to-back 2]: vaddr=0x00001000
  [PTW] Starting translation for vaddr=0x00001000
[1165] PTW State: 0 -> 1
  [DEBUG] PTW request: vaddr=0x00001000, VPN1=   0, VPN0=   1
[PTW] Request: vaddr=0x00001000, vpn1=   0, vpn0=   1
[1185] PTW State: 1 -> 2
  [DEBUG] Memory request: addr=0x00000400
[PTW] Memory Request: addr=0x00000400
[1205] PTW State: 2 -> 3
  [DEBUG] Memory response: data=0x00000801
[PTW] Memory Response: data=0x00000801
[1225] PTW State: 3 -> 4
  [DEBUG] Memory request: addr=0x00000804
[PTW] Memory Request: addr=0x00000804
[1245] PTW State: 4 -> 5
  [DEBUG] Memory response: data=0x1100000f
[PTW] Memory Response: data=0x1100000f
[1265] PTW State: 5 -> 0
  [DEBUG] PTW response: pte=0x1100000f
[PTW] Response: pte=0x1100000f
  [PTW] Translation complete: pte=0x1100000f
PASS [                  Back-to-back 2]: vaddr=0x00001000 -> pte=0x1100000f


=== Test 8: Response Delay Handling ===
  [PTW] Starting translation for vaddr=0x00000000
[PTW] Request: vaddr=0x00000000, vpn1=   0, vpn0=   0
  [DEBUG] PTW request: vaddr=0x00000000, VPN1=   0, VPN0=   0
[1295] PTW State: 0 -> 1
[PTW] Memory Request: addr=0x00000400
  [DEBUG] Memory request: addr=0x00000400
[1315] PTW State: 1 -> 2
[PTW] Memory Response: data=0x00000801
  [DEBUG] Memory response: data=0x00000801
[1335] PTW State: 2 -> 3
[PTW] Memory Request: addr=0x00000800
  [DEBUG] Memory request: addr=0x00000800
[1355] PTW State: 3 -> 4
[PTW] Memory Response: data=0x1000000f
  [DEBUG] Memory response: data=0x1000000f
[1375] PTW State: 4 -> 5
[PTW] Response: pte=0x1000000f
  [DEBUG] PTW response: pte=0x1000000f
[1395] PTW State: 5 -> 0
  [PTW] Translation complete: pte=0x1000000f
PASS [                Delayed response]: pte=0x1000000f

=== Test 9: Rapid Sequential Translations ===
  [PTW] Starting translation for vaddr=0x00000000
[1425] PTW State: 0 -> 1
  [DEBUG] PTW request: vaddr=0x00000000, VPN1=   0, VPN0=   0
[PTW] Request: vaddr=0x00000000, vpn1=   0, vpn0=   0
[1445] PTW State: 1 -> 2
  [DEBUG] Memory request: addr=0x00000400
[PTW] Memory Request: addr=0x00000400
[1465] PTW State: 2 -> 3
  [DEBUG] Memory response: data=0x00000801
[PTW] Memory Response: data=0x00000801
[1485] PTW State: 3 -> 4
  [DEBUG] Memory request: addr=0x00000800
[PTW] Memory Request: addr=0x00000800
[1505] PTW State: 4 -> 5
  [DEBUG] Memory response: data=0x1000000f
[PTW] Memory Response: data=0x1000000f
[1525] PTW State: 5 -> 0
  [DEBUG] PTW response: pte=0x1000000f
[PTW] Response: pte=0x1000000f
  [PTW] Translation complete: pte=0x1000000f
PASS: Rapid test           0: vaddr=0x00000000 -> pte=0x1000000f
  [PTW] Starting translation for vaddr=0x00001000
[PTW] Request: vaddr=0x00001000, vpn1=   0, vpn0=   1
  [DEBUG] PTW request: vaddr=0x00001000, VPN1=   0, VPN0=   1
[1555] PTW State: 0 -> 1
[PTW] Memory Request: addr=0x00000400
  [DEBUG] Memory request: addr=0x00000400
[1575] PTW State: 1 -> 2
[PTW] Memory Response: data=0x00000801
  [DEBUG] Memory response: data=0x00000801
[1595] PTW State: 2 -> 3
[PTW] Memory Request: addr=0x00000804
  [DEBUG] Memory request: addr=0x00000804
[1615] PTW State: 3 -> 4
[PTW] Memory Response: data=0x1100000f
  [DEBUG] Memory response: data=0x1100000f
[1635] PTW State: 4 -> 5
[PTW] Response: pte=0x1100000f
  [DEBUG] PTW response: pte=0x1100000f
[1655] PTW State: 5 -> 0
  [PTW] Translation complete: pte=0x1100000f
PASS: Rapid test           1: vaddr=0x00001000 -> pte=0x1100000f
  [PTW] Starting translation for vaddr=0x80000000
[1685] PTW State: 0 -> 1
  [DEBUG] PTW request: vaddr=0x80000000, VPN1= 512, VPN0=   0
[PTW] Request: vaddr=0x80000000, vpn1= 512, vpn0=   0
[1705] PTW State: 1 -> 2
  [DEBUG] Memory request: addr=0x00000c00
[PTW] Memory Request: addr=0x00000c00
[1725] PTW State: 2 -> 5
  [DEBUG] Memory response: data=0x00000000
[PTW] Memory Response: data=0x00000000
[1745] PTW State: 5 -> 0
  [DEBUG] PTW response: pte=0x00000000
[PTW] Response: pte=0x00000000
  [PTW] Translation complete: pte=0x00000000
PASS: Rapid test           2: vaddr=0x80000000 -> pte=0x00000000

========================================
PTW Test Summary:
  Tests Passed:          15
  Tests Failed:           0
ALL TESTS PASSED!
========================================
